https://script.google.com/macros/s/AKfycbz3pYzWO5FgY-G9X7qH8vyprGLC9sSL63j34rMnn7JXLk0TyoSE81IN5Brm_sKxM6LH_w/exec




<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Attendance Tracker</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }

    #scanner {
      width: 100%;
      height: 300px;
      border: 3px solid #0d6efd;
      border-radius: 10px;
      margin: 20px 0;
      background: #fff;
    }

    #output {
      max-height: 250px;
      overflow-y: auto;
    }

    #output p {
      margin: 5px;
      padding: 10px;
      background-color: #e9f7ef;
      border-left: 5px solid #198754;
      border-radius: 4px;
      font-weight: 500;
    }

    @media (max-width: 576px) {
      #scanner {
        height: 250px;
      }
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>

<div class="container py-4">
  <h1 class="text-center text-primary mb-4">ðŸ“· Student Attendance Tracker</h1>

  <div class="mb-3">
    <label for="fileInput" class="form-label">Upload Excel File (.xlsx)</label>
    <input type="file" class="form-control" id="fileInput" accept=".xlsx, .xls">
  </div>

  <div id="scanner"></div>

  <div class="text-center">
    <button id="downloadBtn" class="btn btn-success mt-3 d-none">â¬‡ Download Updated Attendance</button>
  </div>

  <h5 class="mt-4">âœ… Recent Scans</h5>
  <div id="output" class="bg-white p-3 shadow-sm rounded"></div>
</div>

<script>
  let students = {};
  let attendance = {};
  let lastScanned = "";
  const scriptURL = "https://script.google.com/macros/s/AKfycbz3pYzWO5FgY-G9X7qH8vyprGLC9sSL63j34rMnn7JXLk0TyoSE81IN5Brm_sKxM6LH_w/exec
";

  document.getElementById('fileInput').addEventListener('change', handleFile, false);
  document.getElementById('downloadBtn').addEventListener('click', downloadAttendance, false);

  function handleFile(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
      const jsonData = XLSX.utils.sheet_to_json(firstSheet);

      jsonData.forEach(student => {
        students[student.EnrollmentNo] = student.Name;
        attendance[student.EnrollmentNo] = 'Absent';
      });

      document.getElementById('downloadBtn').classList.remove("d-none");
      startScanning();
    };
    reader.readAsArrayBuffer(file);
  }

  function startScanning() {
    if (Quagga.initialized) return;

    Quagga.init({
      inputStream: {
        name: "Live",
        type: "LiveStream",
        target: document.querySelector('#scanner'),
        constraints: {
          facingMode: "environment"
        }
      },
      decoder: { readers: ["code_128_reader"] }
    }, function(err) {
      if (err) {
        console.error(err);
        return;
      }
      Quagga.start();
      Quagga.onDetected(onDetected);
      Quagga.initialized = true;
    });
  }

  function onDetected(result) {
    const enrollmentNo = result.codeResult.code;
    if (enrollmentNo === lastScanned) return;
    lastScanned = enrollmentNo;

    if (students[enrollmentNo]) {
      if (attendance[enrollmentNo] === 'Absent') {
        attendance[enrollmentNo] = 'Present';
        sendToGoogleSheets(enrollmentNo, students[enrollmentNo]);

        const outputDiv = document.getElementById('output');
        const entry = document.createElement('p');
        entry.classList.add('fade-in');
        entry.textContent = `âœ” ${students[enrollmentNo]} (${enrollmentNo}) marked Present`;
        outputDiv.prepend(entry);
      }
    }

    setTimeout(() => lastScanned = "", 500);
  }

  function sendToGoogleSheets(enrollmentNo, studentName) {
    const formData = new FormData();
    formData.append("EnrollmentNo", enrollmentNo);
    formData.append("Name", studentName);
    formData.append("Status", "Present");

    fetch(scriptURL, {
      method: "POST",
      body: formData
    })
    .then(res => res.json())
    .then(data => console.log("âœ… Sent:", data))
    .catch(err => console.error("âŒ Error:", err));
  }

  function downloadAttendance() {
    const updatedData = Object.keys(attendance).map(enrollmentNo => ({
      EnrollmentNo: enrollmentNo,
      Name: students[enrollmentNo],
      Status: attendance[enrollmentNo]
    }));

    const ws = XLSX.utils.json_to_sheet(updatedData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Attendance");
    XLSX.writeFile(wb, "Updated_Attendance.xlsx");
  }

  // Prevent page close
  window.onbeforeunload = () => "Are you sure you want to leave? Unsaved attendance may be lost.";
</script>

</body>
</html>
